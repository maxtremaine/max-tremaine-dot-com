<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Max Tremaine.com</title>
		<link href="icon.jpg" rel="icon" type="image/jpeg" />
		<link href="https://fonts.googleapis.com/css?family=Lato|Josefin+Slab:100" rel="stylesheet" />
		<link href="drc.css" rel="stylesheet" />
		<style>
			h1, h2 {
				padding: 18vh 2vw;
			}
			.fewer {
				display: none;
			}
		</style>
	</head>
	<body>
		<section>
			<article id="titles">
				<h1 style="font-size:7vh;">Max Tremaine<span style="font-size:3vh;color:#6BADBE;">.com</span></h1>
				<h2 style="font-size:4vh;font-family:'Josefin Slab',serif;">Co-Founder of <a href="https://www.joinsherpa.com" style="font-family:'Josefin Slab',serif;font-size:4vh;">Sherpa</a></h2>
				<hr />
			</article>
			<article id="intro">
				<p>Hello,</p>
				<p>Welcome to Max Tremaine.com, the internet's best summary resource for information about me, Max Tremaine. I spend most of my time working on <a href="http://www.joinsherpa.com" target="_blank">Sherpa</a>: the easiest way to get a travel visa. I also host <a href="http://www.traveltechto.com" target="_blank">TravelTechTO</a> on a quarterly basis. I'm interested in statistical learning, citizenship, database management systems, and disruption theory.</p>
				<p>If you're a computer, you can also read my website <a href="maxTremaineDotCom.json" target ="_blank">in JSON</a>.</p>
				<p>-Max</p>
				<hr />
			</article>
			<article id="contact">
				<h3>How to get in touch:</h3>
				<ul style="margin: 2vh 1vh;">
					<li>I have public <a href="http://www.twitter.com/maxtremaine" target="_blank">Twitter</a> direct messages turned on, and I'll get push notifications.</li>
					<li>If you want to connect in a businessy way, I also get push notifications from <a href="https://ca.linkedin.com/in/maxtremaine" target="_blank">LinkedIn</a>.</li>
					<li>If you're super serious about business, I also have an <a href="https://angel.co/maxtremaine" target="_blank">Angel List</a> account, which I check periodically.</li>
					<li>You can email me at <a href="mailto:me@maxtremaine.com">me@maxtremaine.com</a>, but I may not see it.</li>
				</ul>
				<hr />
			</article>
		</section>
		<section id="articles_from_data" style="display:none;">
			<article id="articles">
				<h3>Articles:</h3>
				<table id="article_table"></table>
				<button id="more_articles" class="list_button" onclick="listButton('extra_articles','more_articles','fewer_articles','table-row')">More</button>
				<button id="fewer_articles" class="fewer list_button" onclick="listButton('extra_articles','fewer_articles','more_articles')">Fewer</button>
				<hr />
			</article>
			<article id="favourite_books">
				<h3>Favourite Books:</h3>
				<ol id="favourite_books_list" style="margin: 2vh 3vh;"></ol>
				<button id="more_books" class="list_button" onclick="listButton('extra_books','more_books','fewer_books','list-item')">More</button>
				<button id="fewer_books" class="fewer list_button" onclick="listButton('extra_books','fewer_books','more_books')">Fewer</button>
				<hr />
			</article>
			<article id="favourite_quotes">
				<h3>Favourite Quotes:</h3>
				<ul id="favourite_quotes_list"></ul>
				<button id="more_quotes" class="list_button" onclick="listButton('extra_quotes','more_quotes','fewer_quotes','list-item')">More</button>
				<button id="fewer_quotes" class="fewer list_button" onclick="listButton('extra_quotes','fewer_quotes','more_quotes')">Fewer</button>
				<hr />
			</article>
			<article id="resume">
				<h3>Resume:</h3>
				<table id="resume_table"></table>
				<button id="more_jobs" class="list_button" onclick="listButton('extra_jobs','more_jobs','fewer_jobs','table-row')">More</button>
				<button id="fewer_jobs" class="fewer list_button" onclick="listButton('extra_jobs','fewer_jobs','more_jobs')">Fewer</button>
				<hr />
			</article>
		</section>
		<footer style="margin-bottom:10vh;">
			<h4 style="font-size:2vh;text-align:right;">Thanks for stopping by.</h4>
		</footer>
		<script src="construction.js"></script>
		<script>
			/**
			 * Coordinates site construction from a static JSON database.
			 */
			window.onload = function populatePage() {
				var xhr = new XMLHttpRequest();
				xhr.open('GET', 'maxTremaineDotCom.json', true);
				xhr.responseText = 'text';
				xhr.onloadend = function arrangePageData() {
					if(xhr.status === 200) {
						// Response from the website's database.
						var res = JSON.parse(xhr.responseText).maxTremaineDotCom;

						// Show section containers.
						document.getElementById('articles_from_data').style.display = 'block';

						// Format data into arrays of objects.
						var articles = res.data.articles.toSortedList('order');
						var books = res.data.favouriteBooks.toSortedList('rank');
						var quotes = res.data.favouriteQuotes.toSortedList('length');
						var jobs = res.data.resume.toSortedList('year', true);

						// Crate and place elements on the page.
						Article.createBatch(articles);
						Book.createBatch(books);
						Quote.createBatch(quotes);
						Job.createBatch(jobs);
						hideExtras();

						// Log xhr status.
						console.log("Database xhr status: " + xhr.status + " - " + xhr.statusText);

						// Log meta from the database.
						logMeta(res.meta);
					} else {
						// Log xhr status.
						console.log("Database xhr status: " + xhr.status + " - " + xhr.statusText);
					}
				}
				xhr.send();
			};
			/**
			 * @param {string} title
			 * @param {string} description
			 * @param {string} link
			 */
			function Article(title, description, link) {
				this.title = title;
				this.description = description;
				this.link = link;
			}
			Article.section = document.getElementById('article_table');
			/**
			 * Creates article items in the following format:
			 *     <tr class=[class] style="vertical-align: top;">
			 *         <td style="padding: 2vh;">
			 *             <a href=[link] target="_blank">[title]</a>
			 *         </td>
			 *         <td style="padding: 2vh;">[description]</td>
			 *     </tr>
			 * @param {number} i
			 */
			Article.prototype.load = function LoadArticle(i) {
				var articleRow = document.createElement('tr');
				var leftData = document.createElement('td');
				var articleLink = document.createElement('a');
				var articleTitle = document.createTextNode(this.title);
				var rightData = document.createElement('td');
				var articleDescription = document.createTextNode(this.description);
				var articlePadding = 'padding: 2vh;';
				Article.section.appendChild(articleRow);
				articleRow.className = i > 1 ? 'extra_articles' : '';
				articleRow.style = (i + 1) % 2 === 0
					? 'vertical-align: top; background-color: WhiteSmoke;'
					: 'vertical-align: top;';
				articleRow.appendChild(leftData);
				leftData.className = 'descriptor';
				leftData.style = articlePadding;
				leftData.appendChild(articleLink);
				articleLink.href = this.link;
				articleLink.target = '_blank';
				articleLink.appendChild(articleTitle);
				articleRow.appendChild(rightData);
				rightData.style = articlePadding;
				rightData.appendChild(articleDescription);
			};
			/**
			 * Creates a bunch of articles from an array.
			 * @param {Article[]} articles
			 */
			Article.createBatch = function(articles) {
				for(var i = 0; i < articles.length; i++) {
					var article = new Article(articles[i].title, articles[i].description,
						articles[i].link);
					article.load(i);
				}
			};
			/**
			 * @param {string} key
			 * @param {string} title
			 * @param {string} author
			 * @param {string} link
			 * @param {string} description
			 * @param {string} favouriteQuote
			 * @param {number} rank
			 */
			function Book(key, title, author, link, description,favouriteQuote, rank) {
				this.key = key;
				this.title = title;
				this.author = author;
				this.link = link;
				this.description = description;
				this.favouriteQuote = favouriteQuote;
				this.rank = rank;
			}
			Book.section = document.getElementById('favourite_books_list');
			/**
			 * Creates book items in the following format:
			 *     <li class=[class] style="list-style-position:inside;">
			 *         <a href=[link] target="_blank">[title]</a>
			 *         [author]
			 *     </li>
			 * @param {number} i
			 */
			Book.prototype.load = function loadBook(i) {
				var link = 'book.html?title=' + this.key;
				var bookItem = document.createElement('li');
				var bookLink = document.createElement('a');
				var title = document.createTextNode(this.title);
				var author = document.createTextNode(' by ' + this.author);
				Book.section.appendChild(bookItem);
				bookItem.className = i > 2 ? 'extra_books' : '';
				bookItem.appendChild(bookLink);
				bookLink.href = link;
				bookLink.appendChild(title);
				bookItem.appendChild(author);
			};
			/**
			 * Creates a bunch of books from an array.
			 * @param {Book[]} books
			 */
			Book.createBatch = function createBatchOfBooks(books) {
				for(var i = 0; i < books.length; i++) {
					var book = new Book(books[i].key, books[i].title, books[i].author, books[i].link,
						books[i].description, books[i].favouriteQuote, books[i].rank);
					book.load(i);
				}
			};
			/**
			 * @param {string} quote
			 * @param {string} author
			 * @param {boolean} public
			 */
			function Quote(quote, author, public) {
				this.quote = quote;
				this.author = author;
				this.public = public;
			}
			Quote.section = document.getElementById('favourite_quotes_list');
			/**
			 * Creates quote items in the following format:
			 *     <li class=[class] style="list-style-type:none; margin: 2vh 1vh;">
			 *         <q>[quote]</q>
			 *         <p style="text-align:right;">[author]</p>
			 *     </li>
			 * @param {number} i Used as an index.
			 * @param {number} j Determines hidden quotes.
			 * @returns {boolean} Whether j should be incremented.
			 */
			Quote.prototype.load = function loadQuote(i, j) {
				var incrementJ = false;
				if(this.public) {
					var quoteItem = document.createElement('li');
					var quoteElement = document.createElement('q');
					var quote = document.createTextNode(this.quote);
					var authorElement = document.createElement('p');
					var author = document.createTextNode('- ' + this.author);
					Quote.section.appendChild(quoteItem);
					quoteItem.className = j > 1 ? 'extra_quotes' : '';
					quoteItem.style = 'list-style-type:none;margin:2vh 1vh;';
					quoteItem.appendChild(quoteElement);
					quoteElement.appendChild(quote);
					quoteItem.appendChild(authorElement);
					authorElement.style = 'text-align:right;';
					authorElement.appendChild(author);
					incrementJ = true;
				}
				return incrementJ;
			};
			/**
			 * Creates a bunch of quotes from an array.
			 * @param {Quote[]} quotes
			 */
			Quote.createBatch = function createBatch(quotes) {
				for(var i = 0, j = 0; i < quotes.length; i++) {
					var quote = new Quote(quotes[i].quote, quotes[i].author, quotes[i].public);
					var incrementJ = quote.load(i, j); // "j" defines cutoff for hidden quotes.
					if(incrementJ) j++;
				}
			};
			/**
			 * @param {string} company
			 * @param {string} title
			 * @param {string} period
			 * @param {string} description
			 * @param {string} link
			 */
			function Job(company, title, period, description, link) {
				this.company = company;
				this.title = title;
				this.period = period;
				this.description = description;
				this.link = link;
			}
			Job.section = document.getElementById('resume_table');
			/**
			 * Creates resume items in the Job section in the following format:
			 *     <tr class=[class] style="vertical-align: top;">
			 *         <td class="descriptor" style="padding: 2vh;">
			 *             <a href=[link] target="_blank">[company]</a>
			 *         </td>
			 *         <td style="padding: 2vh;">[title]</td>
			 *     </tr>
			 *     <tr class=[class] style="vertical-align: top;">
			 *         <td class="descriptor detail" style="padding: 2vh;">[period]</td>
			 *         <td style="padding: 2vh;" class="detail">[detail]</td>
			 *     </tr>
			 * @param {number} i
			 */
			Job.prototype.load = function(i) {
				var topRow = document.createElement('tr');
				var topLeft = document.createElement('td');
				var jobLink = document.createElement('a');
				var company = document.createTextNode(this.company);
				var topRight = document.createElement('td');
				var title = document.createTextNode(this.title);
				var bottomRow = document.createElement('tr');
				var bottomLeft = document.createElement('td');
				var period = document.createTextNode(this.period);
				var bottomRight = document.createElement('td');
				var description = document.createTextNode(this.description);
				var itemPadding = 'padding: 2vh;';
				Job.section.appendChild(topRow);
				topRow.className = i > 0 ? 'extra_jobs' : '';
				topRow.style = 'vertical-align:top;';
				topRow.appendChild(topLeft);
				topLeft.className = 'descriptor';
				topLeft.style = itemPadding;
				topLeft.appendChild(jobLink);
				jobLink.href = this.link;
				jobLink.target = '_blank';
				jobLink.appendChild(company);
				topRow.appendChild(topRight);
				topRight.style = itemPadding;
				topRight.appendChild(title);
				Job.section.appendChild(bottomRow);
				bottomRow.className = i > 0 ? 'extra_jobs' : '';
				bottomRow.style = 'vertical-align:top;';
				bottomRow.appendChild(bottomLeft);
				bottomLeft.className = 'descriptor detail';
				bottomLeft.style = itemPadding;
				bottomLeft.appendChild(period);
				bottomRow.appendChild(bottomRight);
				bottomRight.className = 'detail';
				bottomRight.style = itemPadding;
				bottomRight.appendChild(description);
			};
			/**
			 * @param {Job[]} jobs
			 */
			Job.createBatch = function(jobs) {
				for(var i = 0; i < jobs.length; i++) {
					var job = new Job(jobs[i].company, jobs[i].title, jobs[i].period, jobs[i].description,
						jobs[i].link);
					job.load(i);
				}
			};
			/**
			 * Turn an object used to store keyed objects into a list of objects.
			 * @param {string} sortKey Shared key used to sort objects.
			 * @param {boolean} reverse Sort from largest to smallest.
			 * @returns {any[]}
			 */
			Object.prototype.toSortedList = function(sortKey, reverse) {
				if(reverse === undefined) reverse = false;
				var data = Object.values(this);
				data.sort(function(a, b) {
					var counter = a[sortKey] - b[sortKey];
					if(reverse) counter = -counter;
					return counter;
				});
				return data;
			};
			/**
			 * Hide any extra items (as classed).
			 */
			function hideExtras() {
				var classes = ['.extra_books', '.extra_quotes', '.extra_articles', '.extra_jobs'];
				var extras = document.querySelectorAll(classes.join());
				for(var i = 0; i < extras.length; i++)
					extras[i].style.display = 'none';
			}
			/**
			 * Log meta for other nerds.
			 * @param {any} data
			 */
			function logMeta(data) {
				console.log(['Author: ', data.author].join(''));
				console.log(['Contact: ', data.contact].join(''));
				console.log(['Last Updated: ', data.lastUpdated].join(''));
				console.log(data.welcomeMessage);
			}
			/**
			 * Extend or reduce a list.
			 * @param {string} extraClass
			 * @param {string} buttonToHide
			 * @param {string} buttonToShow
			 * @param {string} extraClassDisplayValue
			 */
			function listButton(extraClass, buttonToHide, buttonToShow, extraClassDisplayValue) {
				if(extraClassDisplayValue === undefined) extraClassDisplayValue = 'none';
				document.getElementById(buttonToHide).style.display = 'none';
				document.getElementById(buttonToShow).style.display = 'block';
				var extraClassElements = document.getElementsByClassName(extraClass);
				for(var i = 0; i < extraClassElements.length; i++)
					extraClassElements[i].style.display = extraClassDisplayValue;
			}
		</script>
	</body>
</html>