<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Max's Books</title>
		<link href="icon.jpg" rel="icon" type="image/jpeg" />
		<link href="https://fonts.googleapis.com/css?family=Lato|Josefin+Slab:100" rel="stylesheet" />
		<link href="drc.css" rel="stylesheet" />
		<style>
			h1 {
				padding: 2vh 2vw;
			}
		</style>
	</head>
	<body>
		<section>
			<article>
				<h1 id="title" style="font-size: 6vh;"></h1>
				<h2>by <span id="author" style="font: inherit;"></span> | <a id="link" style="font-family: 'Josefin Slab', serif;" target="_blank">Goodreads</a> | <a href="/" style="font-family: 'Josefin Slab', serif;">Home</a></h2>
				<hr style="margin-bottom: 3vh;" />
				<p id="description"></p>
				<h3>Favourite Quote:</h3>
				<q id="favouriteQuote"></q>
			</article>
		</section>
		<script>
			/**
			 * Populate page from a static database.
			 */
			window.onload = function() {
				var title = (new URL(document.location)).searchParams.get('title');
				var xhr = new XMLHttpRequest();
				xhr.open('GET', 'maxTremaineDotCom.json', true);
				xhr.responseType = 'text';
				xhr.onloadend = function() {
					if(xhr.status === 200) {
						var data = JSON.parse(xhr.responseText).maxTremaineDotCom.data.favouriteBooks[title];
						if(data === undefined) document.location = '/'; // Go away bad requests.
						var book = new Book(data.title, data.author, data.description, data.favouriteQuote, data.link);
						book.populatePage();
						console.log(xhr.statusText);
					} else {
						console.error(xhr.statusText);
					}
				}
				xhr.send();
			};
			/**
			 * @param {string} title
			 * @param {string} author
			 * @param {string} description
			 * @param {string} favouriteQuote
			 * @param {string} link
			 */
			function Book(title, author, description, favouriteQuote, link) {
				this.title = title;
				this.author = author;
				this.description = description;
				this.favouriteQuote = favouriteQuote;
				this.link = link;
			}
			/**
			 * Take book data and add it to the page.
			 */
			Book.prototype.populatePage = function populatePage() {
				var titleHeading = document.getElementById('title');
				var authorSpan = document.getElementById('author');
				var goodreadsLink = document.getElementById('link');
				var descriptionParagraph = document.getElementById('description');
				var favouriteQuote = document.getElementById('favouriteQuote');
				var title = document.createTextNode(this.title);
				var author = document.createTextNode(this.author);
				var description = document.createTextNode(this.description);
				var quote = document.createTextNode(this.favouriteQuote);
				document.title = "Max's Books: " + this.title;
				titleHeading.appendChild(title);
				authorSpan.appendChild(author);
				goodreadsLink.href = this.link;
				descriptionParagraph.appendChild(description);
				favouriteQuote.appendChild(quote);
			}
		</script>
	</body>
</html>